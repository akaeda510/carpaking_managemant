<%= form_with(model: [parking_lot, parking_space], class: "space-y-6") do |f| %>

  <section class="border border-gray-200 p-6 rounded-lg bg-white">
    <h3 class="text-xl font-semibold text-indigo-600 mb-4 border-b pb-2">基本情報</h3>
    
    <div class="grid grid-cols-1 md:grid-cols-2 gap-y-6 gap-x-8">
      
      <div class="col-span-1">
        <%= f.label :name, '駐車番号', class: "block text-sm font-medium text-gray-700" %>
        <% has_history = parking_space.contract_parking_spaces.exists? %>
        
        <div class="mt-1 relative rounded-md shadow-sm max-w-[180px]">
          <%= f.text_field :name, 
              autofocus: !has_history, 
              readonly: has_history,
              class: "block w-full border rounded-md py-2 px-3 sm:text-sm transition-colors
                #{has_history ? 'bg-gray-50 border-gray-200 text-gray-500 cursor-not-allowed focus:ring-0 focus:border-gray-200' : 'border-gray-300 focus:ring-indigo-500 focus:border-indigo-500'}" %>
          
          <% if has_history %>
            <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
              <i class="fa-solid fa-lock text-gray-400 text-xs"></i>
            </div>
          <% end %>
        </div>

        <% if has_history %>
          <p class="mt-2 text-[10px] text-amber-600 font-medium flex items-center">
            <i class="fa-solid fa-circle-info mr-1"></i>契約実績があるため変更不可
          </p>
        <% end %>
      </div>

      <div class="col-span-1">
        <%= f.label :price, '月額賃料', class: "block text-sm font-medium text-gray-700" %>
        <div class="mt-1 relative rounded-md shadow-sm max-w-[220px]">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <span class="text-gray-400 sm:text-sm">¥</span>
          </div>
          <%= f.number_field :price,
              class: "block w-full border border-gray-300 rounded-md py-2 pl-7 pr-12 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",
              placeholder: "0" %>
          <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none border-l border-gray-200 ml-2 pl-2">
            <span class="text-gray-400 text-[10px]">/ 月</span>
          </div>
        </div>
      </div>

      <div class="col-span-1 md:col-span-2 mt-2">
        <span class="block text-sm font-medium text-gray-700 mb-3">駐車タイプ</span>
        <div class="flex flex-wrap gap-4">
          <% ParkingSpace.parking_types_i18n.each do |key, label| %>
            <label class="flex items-center cursor-pointer group bg-gray-50 px-4 py-2 rounded-lg border border-gray-200 hover:border-indigo-300 transition-colors">
              <%= f.radio_button :parking_type, key,
                checked: (f.object.parking_type == key),
                class: "h-4 w-4 text-indigo-600 border-gray-300 focus:ring-indigo-500",
                data: { action: "change->parking-space-form#toggle" } %>
              <span class="ml-2 text-sm text-gray-700 group-hover:text-indigo-600 font-medium">
                <%= label %>
              </span>
            </label>
          <% end %>
        </div>
      </div>      

      <div class="col-span-1 md:col-span-2 pt-4 border-t border-gray-100">
        <div class="sm:hidden">
          <details class="group border border-gray-200 rounded-lg bg-gray-50">
            <summary class="flex items-center justify-between cursor-pointer list-none p-4">
              <span class="text-gray-700 font-bold flex items-center">
                <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
                オプション設定
              </span>
              <span class="transition group-open:rotate-180 text-gray-400">
                <svg fill="none" height="20" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" width="20"><path d="M6 9l6 6 6-6"></path></svg>
              </span>
            </summary>
            <div class="px-4 pb-4 border-t border-gray-200 bg-white rounded-b-lg">
              <div class="pt-4">
                <%= render 'options_fields', f: f %>
              </div>
            </div>
          </details>
        </div>

        <div class="hidden sm:block">
          <div class="flex items-center mb-3">
            <svg class="w-5 h-5 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"></path></svg>
            <span class="text-gray-700 font-bold">オプション設定</span>
          </div>
          <div class="bg-gray-50 p-4 rounded-lg border border-gray-100">
            <%= render 'options_fields', f: f %>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="border border-gray-200 p-6 rounded-lg bg-white">
    <h3 class="text-xl font-semibold text-indigo-600 mb-4 border-b pb-2">駐車スペースのサイズ</h3>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      <div>
        <%= f.label :width, '横幅 (m)', class: "block text-sm font-medium text-gray-700" %>
        <div class="mt-1 relative rounded-md shadow-sm max-w-[150px]">
          <%= f.number_field :width, step: '0.1', min: 0, class: "block w-full border border-gray-300 rounded-md py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pr-10" %>
          <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
            <span class="text-gray-500 sm:text-sm">m</span>
          </div>
        </div>
      </div>

      <div>
        <%= f.label :length, '長さ (m)', class: "block text-sm font-medium text-gray-700" %>
        <div class="mt-1 relative rounded-md shadow-sm max-w-[150px]">
          <%= f.number_field :length, step: '0.1', min: 0, class: "block w-full border border-gray-300 rounded-md py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pr-10" %>
          <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
            <span class="text-gray-500 sm:text-sm">m</span>
          </div>
        </div>
      </div>

      <div data-parking-space-form-target="garageFields"
           class="col-span-1 sm:col-span-2 <%= 'hidden' unless parking_space.parking_type == 'garage' %>">
           <%= f.fields_for :garage_detail do |g| %>
             <%= g.label :height, "高さ (m)", class: "block text-sm font-medium text-gray-700" %>
             <div class="mt-1 relative rounded-md shadow-sm max-w-[150px]">
               <%= g.number_field :height, step: "0.1", min: 0, placeholder: "例: 2.1",
                 class: "block w-full border border-gray-300 rounded-md py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm pr-10" %>
               <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                 <span class="text-gray-500 sm:text-sm">m</span>
               </div>
             </div>
           <% end %>
      </div>
    </div>
  </section>

  <section class="border border-gray-200 p-6 rounded-lg bg-white">
    <h3 class="text-xl font-semibold text-indigo-600 mb-4 border-b pb-2">説明 概要</h3>
    <%= f.text_area :description, rows: 5, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm", placeholder: "車室に関する特記事項があれば入力してください" %>
  </section>

  <div class="actions pt-4">
    <%= f.submit (parking_space.new_record? ? "駐車場を作成" : "更新する"), 
      class: "w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-bold text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 cursor-pointer transition-all active:scale-[0.98]" %>
  </div>
<% end %>
