<div class="min-h-screen bg-gray-50 flex flex-col items-center py-12 sm:px-6 lg:px-8">
  <div class="max-w-4xl w-full bg-white shadow-xl rounded-lg p-8">

    <h2 class="text-3xl font-extrabold text-gray-900 text-center mb-8">
      契約者作成
    </h2>
    
    <%# 注意: form_with のモデルは @contractor で正しい %>
    <%= form_with(model: @contractor, class: "space-y-6" ) do |f| %>

      <%# 1. 基本情報セクション (変更なし) %>
      <section class="border border-gray-200 p-6 rounded-lg bg-white">
        <h3 class="text-xl font-semibold text-indigo-600 mb-4 border-b pb-2">基本情報</h3>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">

          <%# 氏名 (姓) %>
          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500"><%= f.label :first_name, '氏名 (姓)' %> <span class="text-red-500">*</span></dt>
            <dd class="sm:col-span-2">
              <%= f.text_field :first_name, autofocus: true, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm form-control", placeholder: "山田" %>
            </dd>
          </div>

          <%# 氏名 (名) %>
          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500"><%= f.label :last_name, '氏名 (名)' %> <span class="text-red-500">*</span></dt>
            <dd class="sm:col-span-2">
              <%= f.text_field :last_name, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm form-control" %>
            </dd>
          </div>

          <%# 都道府県 %>
          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500"><%= f.label :prefecture, '都道府県' %> <span class="text-red-500">*</span></dt>
            <dd class="sm:col-span-2">
              <%= f.text_field :prefecture, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm form-control" %>
            </dd>
          </div>

          <%# 市区町村 %>
          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500"><%= f.label :city, '市区町村' %> <span class="text-red-500">*</span></dt>
            <dd class="sm:col-span-2">
              <%= f.text_field :city, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm form-control" %>
            </dd>
          </div>

          <%# 番地 %>
          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500"><%= f.label :street_address, '丁目番地号' %> <span class="text-red-500">*</span></dt>
            <dd class="sm:col-span-2">
              <%= f.text_field :street_address, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm form-control" %>
            </dd>
          </div>

          <%# 建物名 %>
          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500"><%= f.label :building, '建物名・部屋番号 (任意)' %></dt>
            <dd class="sm:col-span-2">
              <%= f.text_field :building, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm form-control" %>
            </dd>
          </div>

          <%# 電話番号 %>
          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500"><%= f.label :phone_number, '携帯電話番号' %> <span class="text-red-500">*</span></dt>
            <dd class="sm:col-span-2">
              <%= f.text_field :phone_number, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm form-control" %>
            </dd>
          </div>

          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500"><%= f.label :contact_number, '電話番号 (任意)' %></dt>
            <dd class="sm:col-span-2">
              <%= f.text_field :contact_number, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm form-control" %>
            </dd>
          </div>

        </div>
      </section>
      
      <%# 2. 🌟 新規追加: 駐車スペース契約情報セクション 🌟 %>
      <section class="border border-gray-200 p-6 rounded-lg bg-white">
        <h3 class="text-xl font-semibold text-green-600 mb-4 border-b pb-2">駐車スペース契約情報 (任意)</h3>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">

          <%# 駐車スペース選択 %>
          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500">
              <%= f.label :parking_space_id, '新規で契約する駐車スペース' %>
            </dt>
            <dd class="mt-1">
              <%= f.select :parking_space_id, 
                           options_for_select(@available_spaces.map { |s| ["#{s.name} (#{s.parking_lot.address})", s.id] }),
                           { include_blank: 'スペースを新規で契約しない' },
                           class: "block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-green-500 focus:border-green-500 sm:text-sm form-control" %>
              <p class="mt-1 text-xs text-gray-500">※ このフォームから駐車スペースを登録した場合、新規契約として作成されます。</p>
            </dd>
          </div>

          <%# 契約開始日 %>
          <div class="col-span-1 sm:col-span-2">
            <dt class="text-sm font-medium text-gray-500">
              <%= f.label :start_date, '契約開始日' %>
            </dt>
            <dd class="mt-1">
              <%# 初期値として今日の日付を設定すると便利です %>
              <%= f.date_field :start_date, value: Date.current,
                               class: "block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:ring-green-500 focus:border-green-500 sm:text-sm form-control" %>
              <p class="mt-1 text-xs text-gray-500">※ スペースを選択した場合、この日付で契約が開始されます。</p>
            </dd>
          </div>
          
          <%# 既存契約の全終了フラグ (編集時のみ有効) %>
          <% if @contractor.persisted? %>
            <div class="col-span-1 sm:col-span-2 pt-2">
              <div class="flex items-start">
                <div class="flex items-center h-5">
                  <%= f.check_box :should_end_all_contracts, 
                                  class: "h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500" %>
                </div>
                <div class="ml-3 text-sm">
                  <label for="contractor_should_end_all_contracts" class="font-medium text-red-700">
                    現在有効な全ての契約を終了する
                  </label>
                  <p class="text-gray-500">※ チェックを入れると、この契約者が持つ全ての有効な駐車スペース契約が本日付けで終了されます。</p>
                </div>
              </div>
            </div>
          <% end %>

        </div>
      </section>


      <%# 3. 備考セクション (dlタグの閉じタグを修正) %>
      <section class="py-4">
        <h2 class="text-xl font-semibold text-gray-800 mb-4">✍️ 備考</h2>
        <div class="space-y-4"> <%# dlタグを廃止しdivで代替 %>
          <div class="grid grid-cols-1 gap-4 py-3 px-4 bg-gray-50 rounded-lg">
            <dt class="text-sm font-medium text-gray-500 mb-2"><%= f.label :notes, '特記事項・その他 (任意)' %></dt>
            <dd>
              <%= f.text_area :notes, rows: 4, class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm form-control" %>
            </dd>
          </div>
        </div>
      </section>

      <%# 4. 送信ボタン %>
      <div class="actions pt-4">
        <%= f.submit "更新",
          class: "w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 cursor-pointer" %>
      </div>
    <% end %>
    <div class="mt-10 pt-6 flex justify-center space-x-4">

      <%= link_to contractors_path,
        class: "inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" do %>
        <svg class="-ml-1 mr-2 h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
        </svg>
        契約者一覧に戻る
      <% end %>
    </div>
  </div>
</div>
